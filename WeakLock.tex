\section{Алгоритм мягкой блокировки}

\begin{lstlisting}[language=csh,caption={Алгоритм Cassandra.TryGetLock(lockId, threadId)}]
  1.  |Если в основной таблице есть хотя бы одна запись|
  2.  	|Вернуть false|
  3.  |Добавить поток в очередь|
  4.  |Если наш поток - первый в очереди:|
  5.  	|Добавить ячейку в основную таблицу|
  6.  	|Если в основной таблице есть только одна запись:|
  7.  		|Вернуть true|
  8.  	|Иначе:|
  9.  			|Удалить ячейку из основной таблицы|
 10.  		|Перейти к шагу 4|
 11.  |Иначе:|
 12.  	|Удалить поток из очереди|
 13.  	|Вернуть false|
\end{lstlisting}