\subsection{Алгоритм обязательной блокировки}

\begin{lstlisting}[language=csh,caption={Алгоритм Cassandra.GetLock(lockId, threadId)}]
  1.  |Добавить поток в очередь|
  2.  |Если наш поток - первый в очереди:|
  3.  	|Добавить ячейку в основную строку|
  4.  	|Если в основной строке есть только одна запись:|
  5.  		|Закончить|
  6.  	|Иначе:|
  7.  		|Удалить ячейку из основной строки|
  8.  		|Перейти к шагу 2|
  9.  |Иначе:|
 10.  	|Перейти к шагу 2|

\end{lstlisting}

\begin{theorem}
В ходе выполнения алгоритма Cassandra.GetLock несколькими потоками блокировка не будет взята более чем одним потоком одновременно.
\end{theorem}

\begin{theorem}
Если в одно и то же время в очередь может поступить не более N потоков, то при одновременном выполнении алгоритма Cassandra.GetLock несколькими потоками рано или поздно каждый поток сможет захватить блокировку, обратившись к основной строке не более N раз.
\end{theorem}